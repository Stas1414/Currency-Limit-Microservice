# Currency Limit Microservice

## Описание

Этот микросервис реализует функциональность для учета расходных операций, хранения месячных лимитов по расходам в долларах США, запросов и хранения данных о курсе валют, а также возможности обработки транзакций с превышением лимита. Микросервис использует Spring Boot, Spring Data, и базу данных для хранения информации о транзакциях и курсах валют. Микросервис также включает API для работы с лимитами и транзакциями.

## Функциональность

Микросервис решает следующие задачи:

1. **Получение информации о расходных операциях**:
   - Сохраняет операции в тенге (KZT), рублях (RUB) и других валютах.
   
2. **Месячный лимит по расходам в долларах США (USD)**:
   - Хранит лимиты для товаров и услуг.
   - Если лимит не установлен, по умолчанию принимает значение 1000 USD.

3. **Получение и хранение курсов валют**:
   - Запрашивает данные о валютных парах KZT/USD, RUB/USD с биржи по дневному интервалу.
   - При отсутствии данных (выходной или праздничный день) использует данные последнего закрытия (previous_close).

4. **Обработка транзакций, превышающих лимит**:
   - Помечает транзакции, которые превысили лимит, с флагом `limit_exceeded`.

5. **Установка нового лимита**:
   - Дает возможность клиенту установить новый лимит с текущей датой.
   - Обновление существующего лимита запрещено.

6. **Запрос транзакций, превысивших лимит**:
   - Возвращает список транзакций, которые превышают лимит, с указанием лимита, валюты и даты.

## Технологии
- Java 17
- Spring Boot 3
- Spring Data JPA
- Spring Web
- Spring Cloud OpenFeign
- Hibernate
- Flyway
- JUnit 5

# Установка и настройка

 ## 1. Клонировать репозиторий:

  ```bash
   git clone https://github.com/Stas1414/Currency-Limit-Microservice.git
   cd currency-limit-microservice
```
 ## 2. Запуск приложения

а) Сборка проекта

```bash
mvn clean install
```

б) Запуск Spring Boot приложения

```bash
mvn spring-boot:run
```
 ## 3. Настройка базы данных хранятся в 'application.properties':

 ```properties
spring.datasource.url=jdbc:mysql://localhost:3306/idf
spring.datasource.username=root
spring.datasource.password=root
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
```

# API Endpoints

## 1. Process a Transaction

- **URL**: `/api/transactions/process`
- **Method**: `POST`
- **Description**: Принимает транзакцию и обрабатывает её. Транзакция будет валидирована и обработана сервисом.
- **Request Body**:

  ```json
  {
    "accountFrom" : "124213512",
    "accountTo" : "658456845",
    "date" : "2025-02-01T10:30:00",
    "amount" :  700.0,
    "currency" : "EUR",
    "category" : "products"
  }
  ```
## 2. Получить транзакции, превышающие лимит

- **URL**: `/api/transactions/limit_exceeded`
- **Method**: `GET`
- **Description**: Возвращает список транзакций, которые превысили установленный лимит

## 3. Создать лимит для аккаунта

- **URL**: `/api/limits/create`
- **Method**: `POST`
- **Description**: Создает лимит для аккаунта по указанной категории. Лимит определяет максимальную сумму, которую можно потратить в рамках указанной категории.
- **Request body**:

  ```json
  {
    "accountId": 12345,
    "category": "products",
    "limitAmount": 1000.00
  }
  ```
